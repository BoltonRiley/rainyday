<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rainy Day</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ======================================================
   GLOBAL STYLES
====================================================== */
body {
    margin: 0;
    overflow: hidden;
    color: white;
    font-family: sans-serif;
    background: black;
}

.hidden {
    display: none;
}

/* ======================================================
   BACKGROUND VIDEO
====================================================== */
#bgvideo {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1;
}

/* ======================================================
   AUDIO BUTTON
====================================================== */
#soundToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 16px;
    background: rgba(0,0,0,0.6);
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    z-index: 10;
}

/* ======================================================
   SECTIONS
====================================================== */
section {
    padding: 20px;
    text-align: center;
}

/* ======================================================
   GAME CANVAS
====================================================== */
#gameCanvas {
    background: #111;
    border: 2px solid #555;
    image-rendering: pixelated;
}
</style>
</head>

<body>

<!-- ======================================================
     BACKGROUND MEDIA
====================================================== -->
<video id="bgvideo" autoplay muted loop playsinline>
    <source src="assets/video.mp4" type="video/mp4">
</video>

<audio id="bgaudio" loop>
    <source src="assets/audio.mp3" type="audio/mp3">
</audio>

<button id="soundToggle">ðŸ”‡ Sound Off</button>

<!-- ======================================================
     WEATHER / ENTRY GATE
====================================================== -->
<section id="weatherGate">
    <h1>Rainy Day</h1>
    <p id="output">Checking weatherâ€¦</p>
    <button onclick="startGame()">Enter Anyway (Dev)</button>
</section>

<!-- ======================================================
     CHARACTER BUILDER (PLACEHOLDER)
====================================================== -->
<section id="characterBuilder" class="hidden">
    <h2>Character Builder</h2>
    <p>This will be expanded later.</p>
    <button onclick="startGame()">Start Game</button>
</section>

<!-- ======================================================
     MAIN GAME
====================================================== -->
<section id="gameSection" class="hidden">
    <canvas id="gameCanvas" width="640" height="640"></canvas>
    <p>Move: WASD / Arrow Keys â€” Interact: E</p>
</section>

<!-- ======================================================
     AUDIO LOGIC
====================================================== -->
<script>
const audio = document.getElementById("bgaudio");
const soundBtn = document.getElementById("soundToggle");
let soundOn = false;

soundBtn.onclick = () => {
    soundOn = !soundOn;
    if (soundOn) {
        audio.play();
        soundBtn.textContent = "ðŸ”Š Sound On";
    } else {
        audio.pause();
        soundBtn.textContent = "ðŸ”‡ Sound Off";
    }
};
</script>

<!-- ======================================================
     SECTION CONTROL
====================================================== -->
<script>
function startGame() {
    document.getElementById("weatherGate").classList.add("hidden");
    document.getElementById("characterBuilder").classList.add("hidden");
    document.getElementById("gameSection").classList.remove("hidden");
}
</script>

<!-- ======================================================
     GAME LOOP
====================================================== -->
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const TILE = 40;
const MAP_SIZE = 16;

// 0 = floor, 1 = wall, 2 = interactable
const map = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,2,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,1,0,0,1,1,1,0,1],
  [1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,1],
  [1,0,1,0,1,1,1,0,1,1,1,1,0,1,0,1],
  [1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1],
  [1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1],
  [1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1],
  [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1],
  [1,0,2,0,0,0,0,0,0,1,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const unlocked = new Set();

const player = {
    x: 1,
    y: 1
};

function canMove(x, y) {
    return map[y]?.[x] !== 1;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let y = 0; y < MAP_SIZE; y++) {
        for (let x = 0; x < MAP_SIZE; x++) {
            const tile = map[y][x];

            if (tile === 1) ctx.fillStyle = "#444";
            else if (tile === 2) {
                ctx.fillStyle = unlocked.has(`${x},${y}`) ? "lime" : "red";
            } else ctx.fillStyle = "#222";

            ctx.fillRect(x * TILE, y * TILE, TILE, TILE);
        }
    }

    ctx.fillStyle = "cyan";
    ctx.fillRect(player.x * TILE + 8, player.y * TILE + 8, 24, 24);
}

window.addEventListener("keydown", e => {
    let nx = player.x;
    let ny = player.y;

    if (e.key === "ArrowUp" || e.key === "w") ny--;
    if (e.key === "ArrowDown" || e.key === "s") ny++;
    if (e.key === "ArrowLeft" || e.key === "a") nx--;
    if (e.key === "ArrowRight" || e.key === "d") nx++;

    if (canMove(nx, ny)) {
        player.x = nx;
        player.y = ny;
    }

    if (e.key.toLowerCase() === "e") {
        const key = `${player.x},${player.y}`;
        if (map[player.y][player.x] === 2) {
            unlocked.has(key) ? unlocked.delete(key) : unlocked.add(key);
        }
    }

    draw();
});

draw();
</script>

</body>
</html>
